<idea-plugin>
    <id>com.typo3.fluid.accessibility-linter</id>
    <name>Fluid Accessibility Linter</name>
    <vendor>TYPO3 Community</vendor>
    <version>1.4.0</version>
    
    <description><![CDATA[
        Advanced accessibility linter for TYPO3 Fluid templates with context-aware intelligence.
        Provides sophisticated real-time accessibility checks including:
        <ul>
            <li><b>Image Accessibility:</b> Context-aware alt text validation, decorative image detection, SVG support</li>
            <li><b>Smart Link Analysis:</b> Context-sensitive link text validation with surrounding content analysis</li>
            <li><b>Advanced Form Validation:</b> Fieldset grouping, placeholder anti-patterns, required field consistency</li>
            <li><b>Intelligent Heading Structure:</b> HTML5 sectioning awareness, Fluid layout understanding</li>
            <li><b>Table Classification:</b> Automatic layout vs data table detection with appropriate validation</li>
            <li><b>ARIA Intelligence:</b> Implicit role detection, context-appropriate validation, unnecessary aria-label detection</li>
            <li><b>Navigation Optimization:</b> Skip link target validation, landmark redundancy detection</li>
            <li><b>Interactive Components:</b> Modal focus management, accordion state tracking, tab keyboard navigation</li>
            <li><b>Live Region Management:</b> Content prioritization, competing region detection</li>
            <li><b>Multilingual Support:</b> Language attribute consistency, content language detection</li>
            <li><b>List Semantics:</b> Content-aware ordered vs unordered validation</li>
            <li><b>Radio/Checkbox Groups:</b> Intelligent grouping detection and validation</li>
        </ul>
        <br/>
        <b>Version 1.4.0:</b> All inspections enhanced with context-aware intelligence and sophisticated validation logic.
    ]]></description>
    
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>
    
    <extensionPoints>
        <extensionPoint name="ruleProvider" interface="com.typo3.fluid.linter.rules.RuleProvider"/>
        <extensionPoint name="fixStrategy" interface="com.typo3.fluid.linter.fixes.FixStrategy"/>
    </extensionPoints>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Phase 1: Activate Universal Inspection Entry Point -->
        <!-- Single, rule-engine based inspection (kept alongside legacy during migration) -->
        <localInspection language="HTML"
                         displayName="Universal Fluid Accessibility Check"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.UniversalAccessibilityInspection"/>

        <!-- Phase 1: Core Accessibility Inspections -->
        
        <!-- Image Accessibility (merged: formerly EnhancedImageAccessibilityInspection) -->
        <localInspection language="HTML"
                         displayName="Image accessibility checks"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.ImageAccessibilityInspection"/>
        
        <!-- Form Accessibility -->
        <localInspection language="HTML"
                         displayName="Form inputs missing labels"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.MissingFormLabelInspection"/>
        
        <localInspection language="HTML"
                         displayName="Radio/checkbox groups missing fieldset"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.RadioGroupFieldsetInspection"/>
        
        <!-- Document Structure -->
        <localInspection language="HTML"
                         displayName="Heading hierarchy issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.HeadingHierarchyInspection"/>
        
        <localInspection language="HTML"
                         displayName="Page language attributes"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.PageLanguageInspection"/>
        
        <!-- Phase 2: Navigation & Structure Accessibility Inspections -->
        
        <!-- Link Text Quality -->
        <localInspection language="HTML"
                         displayName="Non-descriptive link text"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.LinkTextInspection"/>
        
        <!-- Navigation Structure -->
        <localInspection language="HTML"
                         displayName="Navigation landmark issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.NavigationLandmarkInspection"/>
        
        <localInspection language="HTML"
                         displayName="Missing skip navigation links"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.SkipLinksInspection"/>
        
        <!-- Enhanced List Validation -->
        <localInspection language="HTML"
                         displayName="Enhanced list semantic issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.ListSemanticInspection"/>
        
        <!-- Table Accessibility -->
        <localInspection language="HTML"
                         displayName="Table accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.TableAccessibilityInspection"/>
        
        <!-- Phase 3: ARIA Roles & Interactive Components -->
        
        <!-- ARIA Role Validation -->
        <localInspection language="HTML"
                         displayName="Invalid or misused ARIA roles"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.AriaRoleInspection"/>
        
        <!-- Modal Dialog Accessibility -->
        <localInspection language="HTML"
                         displayName="Modal dialog accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.ModalDialogInspection"/>
        
        <!-- Accordion/Collapsible Content -->
        <localInspection language="HTML"
                         displayName="Accordion and collapsible content accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.AccordionAccessibilityInspection"/>
        
        <!-- Tab Panel Interface -->
        <localInspection language="HTML"
                         displayName="Tab panel interface accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.TabPanelInspection"/>
        
        <!-- Live Regions -->
        <localInspection language="HTML"
                         displayName="Live region and dynamic content announcement issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.LiveRegionInspection"/>
        
        <!-- Enhanced aria-label Validation -->
        <localInspection language="HTML"
                         displayName="Comprehensive aria-label validation"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.AriaLabelValidationInspection"/>
        
        <!-- Existing Inspections (kept for backward compatibility) -->
        <localInspection language="HTML"
                         displayName="Invalid list structure (Fluid)"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.InvalidListStructureInspection"/>
        
        <!-- Removed separate Enhanced variants; base inspections include enhancements -->
    </extensions>

    <!-- Register built-in providers via custom EP namespace -->
    <extensions defaultExtensionNs="com.typo3.fluid.linter">
        <ruleProvider implementation="com.typo3.fluid.linter.rules.DefaultRuleProvider"/>
        <ruleProvider implementation="com.typo3.fluid.linter.rules.FluidRuleProvider"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddAttributeFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.ReplaceTextFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.WrapElementFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.ChangeAttributeFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddChildElementFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.MarkImageDecorativeFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.DeriveAltFromFilenameFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.GenerateTableHeaderScaffoldFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.GenerateLabelForInputFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddAriaRequiredAttributesFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddSkipLinkFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AdjustHeadingLevelFixStrategy"/>
    </extensions>

    <!-- Settings UI (project-level) -->
    <extensions defaultExtensionNs="com.intellij">
        <projectConfigurable instance="com.typo3.fluid.linter.settings.RuleSettingsConfigurable"
                             id="fluid.accessibility.settings"
                             displayName="Fluid Accessibility"/>
    </extensions>
</idea-plugin>
