<idea-plugin>
    <id>com.typo3.fluid.accessibility-linter</id>
    <name>Fluid Accessibility Linter</name>
    <vendor email="inboxstuff@proton.me">CreateNothing</vendor>
    <version>0.5.1</version>
    
    <!-- Icons are auto-detected from META-INF/pluginIcon.svg and pluginIcon_dark.svg -->
    
    <description><![CDATA[A fast, context-aware accessibility linter for TYPO3 Fluid templates in PhpStorm and other IntelliJ-based IDEs. It flags issues as you type and offers focused quick-fixes that align with WCAG and ARIA best practices.

<br/><br/>
<b>Key features</b>
<ul>
    <li><b>Real-time inspections:</b> images (alt text, decorative/SVG), links (meaningful text), forms (labels, required/state), headings (hierarchy & sectioning), tables (data vs layout, header scope), landmarks & navigation (skip links, redundancy), ARIA roles/attributes (implicit roles, misuse), interactive UI (modals, accordions, tabs), live regions, language attributes, list semantics, and radio/checkbox groups.</li>
    <li><b>Fluid-aware analysis:</b> understands common TYPO3/Fluid patterns embedded in HTML templates.</li>
    <li><b>One-click quick-fixes:</b> add missing labels/attributes, generate table scaffolds, adjust heading levels, mark decorative images, and more.</li>
    <li><b>Configurable rules:</b> sensible defaults with options under <i>Settings | Tools | Fluid Accessibility</i>.</li>
    <li><b>Compatible:</b> tested with PhpStorm and IntelliJ IDEA 2023.3 and newer.</li>
</ul>
<br/>
Built and maintained by CreateNothing for the TYPO3 community. Not affiliated with or endorsed by the TYPO3 Association.]]></description>
    
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>
    
    <extensionPoints>
        <extensionPoint name="ruleProvider" interface="com.typo3.fluid.linter.rules.RuleProvider"/>
        <extensionPoint name="fixStrategy" interface="com.typo3.fluid.linter.fixes.FixStrategy"/>
    </extensionPoints>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Phase 1: Activate Universal Inspection Entry Point -->
        <!-- Single, rule-engine based inspection (kept alongside legacy during migration) -->
        <localInspection language="HTML"
                         displayName="Universal Fluid Accessibility Check"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.UniversalAccessibilityInspection"/>

        <!-- Phase 1: Core Accessibility Inspections -->
        
        <!-- Image Accessibility (merged: formerly EnhancedImageAccessibilityInspection) -->
        <localInspection language="HTML"
                         displayName="Image accessibility checks"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.ImageAccessibilityInspection"/>
        
        <!-- Form Accessibility -->
        <localInspection language="HTML"
                         displayName="Form inputs missing labels"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.MissingFormLabelInspection"/>
        
        <localInspection language="HTML"
                         displayName="Radio/checkbox groups missing fieldset"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.RadioGroupFieldsetInspection"/>
        
        <!-- Document Structure -->
        <localInspection language="HTML"
                         displayName="Heading hierarchy issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.HeadingHierarchyInspection"/>
        
        <localInspection language="HTML"
                         displayName="Page language attributes"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.PageLanguageInspection"/>
        
        <!-- Phase 2: Navigation & Structure Accessibility Inspections -->
        
        <!-- Link Text Quality -->
        <localInspection language="HTML"
                         displayName="Non-descriptive link text"
                         groupName="Fluid Accessibility"
                         enabledByDefault="false"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.LinkTextInspection"/>
        
        <!-- Navigation Structure -->
        <localInspection language="HTML"
                         displayName="Navigation landmark issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.NavigationLandmarkInspection"/>
        
        <localInspection language="HTML"
                         displayName="Missing skip navigation links"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.SkipLinksInspection"/>
        
        <!-- Enhanced List Validation -->
        <localInspection language="HTML"
                         displayName="Enhanced list semantic issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.ListSemanticInspection"/>
        
        <!-- Table Accessibility -->
        <localInspection language="HTML"
                         displayName="Table accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.TableAccessibilityInspection"/>
        
        <!-- Phase 3: ARIA Roles & Interactive Components -->
        
        <!-- ARIA Role Validation -->
        <localInspection language="HTML"
                         displayName="Invalid or misused ARIA roles"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="com.typo3.fluid.linter.inspections.AriaRoleInspection"/>
        
        <!-- Modal Dialog Accessibility -->
        <localInspection language="HTML"
                         displayName="Modal dialog accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.ModalDialogInspection"/>
        
        <!-- Accordion/Collapsible Content -->
        <localInspection language="HTML"
                         displayName="Accordion and collapsible content accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.AccordionAccessibilityInspection"/>
        
        <!-- Tab Panel Interface -->
        <localInspection language="HTML"
                         displayName="Tab panel interface accessibility issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.TabPanelInspection"/>
        
        <!-- Live Regions -->
        <localInspection language="HTML"
                         displayName="Live region and dynamic content announcement issues"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.LiveRegionInspection"/>
        
        <!-- Enhanced aria-label Validation -->
        <localInspection language="HTML"
                         displayName="Comprehensive aria-label validation"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.AriaLabelValidationInspection"/>
        
        <!-- Existing Inspections (kept for backward compatibility) -->
        <localInspection language="HTML"
                         displayName="Invalid list structure (Fluid)"
                         groupName="Fluid Accessibility"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="com.typo3.fluid.linter.inspections.InvalidListStructureInspection"/>
        
        <!-- Removed separate Enhanced variants; base inspections include enhancements -->
    </extensions>

    <!-- Register built-in providers via custom EP namespace -->
    <extensions defaultExtensionNs="com.typo3.fluid.linter">
        <ruleProvider implementation="com.typo3.fluid.linter.rules.DefaultRuleProvider"/>
        <ruleProvider implementation="com.typo3.fluid.linter.rules.FluidRuleProvider"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddAttributeFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.ReplaceTextFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.WrapElementFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.ChangeAttributeFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddChildElementFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.MarkImageDecorativeFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.DeriveAltFromFilenameFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.GenerateTableHeaderScaffoldFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.GenerateLabelForInputFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddAriaRequiredAttributesFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AddSkipLinkFixStrategy"/>
        <fixStrategy implementation="com.typo3.fluid.linter.fixes.AdjustHeadingLevelFixStrategy"/>
    </extensions>

    <!-- Settings UI (project-level) -->
    <extensions defaultExtensionNs="com.intellij">
        <projectConfigurable instance="com.typo3.fluid.linter.settings.RuleSettingsConfigurable"
                             id="fluid.accessibility.settings"
                             displayName="Fluid Accessibility"/>
    </extensions>
</idea-plugin>
